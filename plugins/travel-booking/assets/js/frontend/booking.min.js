!function(e){"use strict";let t=[],a=!1,n=null,r=null,i=null,o=null,l=null,d=null,u=null,c=null,s=null,f=null,p=null,m=null,h=!1,v=null,g=null,$,b,y=null,k=null,_,D,x,w,j={},C=0;e.fn.tour_booking_init=function(){n=e("form#tourBookingForm"),F("info_user")&&(x=JSON.parse(F("info_user"))),n.length>0&&(e.fn._get_elms_tour_booking_form(),e.fn.tour_booking(),x&&(e("input[name=first_name]").val(x.first_name),e("input[name=last_name]").val(x.last_name),e("input[name=email_tour]").val(x.email),e("input[name=phone]").val(x.phone))),x&&(e("input[name=billing_first_name]").val(x.first_name),e("input[name=billing_last_name]").val(x.last_name),e("input[name=billing_email]").val(x.email),e("input[name=billing_phone]").val(x.phone))},e.fn._get_elms_tour_booking_form=function(){d=n.find("input[name=price_ticket]"),l=n.find("input[name=number_ticket]"),u=n.find(".price_ticket"),c=n.find("input[name=number_children]"),s=n.find("input[name=price_children]"),p=n.find(".field-travel-booking"),f=n.find(".price_child"),r=n.find(".tour_date_checkin_checkout"),m=n.find("input[name=date_book]"),v=n.find("input[name=tour_date_starts_after]"),g=n.find("input[name=tour_duration_number]"),$=n.find("input[name=tour_group_discount_data_phys]"),y=n.find(".label-tour-group-discount"),k=n.find("input[name=webtomizer_tour_deposit]"),_=n.find("input[name=_tour_variations_options]");let a=n.find("input[name=tour_month]");w=n.find(".tour-subtotal"),C=e("input[name=woocommerce_price_num_decimals]").val(),c.length>0&&(h=!0),a.length&&(t=a.val().split(","))},e._dates_disable=null,e._max_year=null,e._date_format_default="yy/mm/dd",e._date_format_default_datepicker_range="YYYY/MM/DD",e._tour_date_format=null,e._date_format_convert_php_js={"Y/m/d":"yy/mm/dd","Y-m-d":"yy-mm-dd","d/m/Y":"dd/mm/yy","d-m-Y":"dd-mm-yy","m/d/Y":"mm/dd/yy","m-d-Y":"mm-dd-yy","D, d M, Y":"D, d M, yy","l, d F, Y":"DD, d MM, yy"},e._tour_date_check_in_old="";let Y=null,A=null,O=null;function F(e){let t=e+"=",a=decodeURIComponent(document.cookie),n=a.split(";");for(let r=0;r<n.length;r++){let i=n[r];for(;" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}e._tour_price_of_dates_option=null,e.fn.tour_booking=function(){let t=0,a=new Date,l=new Date,d=n.find("input[name=phys_tour_dates_disable]"),u=n.find("input[name=phys_tour_max_year_enable]");Y=n.find("input[name=phys_tour_price_dates_type]").val();let c=n.find("input[name=phys_tour_price_of_dates_option]");if(_.length>0)try{D=JSON.parse(_.val()),_.val("")}catch(s){D=null}if($.length)try{b=JSON.parse($.val()),$.val("")}catch(f){b=null}if(e.fn.update_tour_total_price(),c.length>0&&""!==c.val()&&"{}"!==c.val())try{e._tour_price_of_dates_option=JSON.parse(c.val()),c.val("")}catch(h){e._tour_price_of_dates_option=null}if(e._tour_date_format=e._date_format_default,void 0!==e._date_format_convert_php_js[travel_booking.tour_date_format]&&(e._tour_date_format=e._date_format_convert_php_js[travel_booking.tour_date_format]),e._max_year=u.val(),d.length>0&&""!==d.val()&&(e._dates_disable=JSON.parse(d.val())),v.length>0&&""!=v.val()&&0!==parseInt(v.val())&&(t=parseInt(v.val())),null!==e._dates_disable){let y=e.fn._convert_date_obj_by_format_default(l);for(;e._dates_disable.indexOf(y)>-1;)l.setDate(l.getDate()+1),y=e.fn._convert_date_obj_by_format_default(l);l.setDate(l.getDate()+t)}else l.setDate(a.getDate()+t);let k={dateFormat:e._tour_date_format,minDate:l,yearRange:l.getFullYear()+":"+e._max_year};if(null!==e._dates_disable&&(k.beforeShowDay=function(t){t=e.fn._convert_date_obj_by_format_default(t);let a=e._dates_disable.indexOf(t);return a>-1?[!1,"",""]:[!0,"","Available"]}),m.length>0&&(delete m.beforeShowDay,jQuery().datepicker)){m.datepicker(k),m.datepicker("setDate",l);let x=parseInt(g.val()),w=function(t){if(e._tour_dates_choose=[],""!==m.val()){let a=new Date(e.fn._convert_date_to_format_default(m.val())),n=a,r=e.fn._convert_date_obj_by_format_default(a),i=new Date(e.fn._convert_date_to_format_default(m.val()));i.setDate(a.getDate()+x);let o=e.fn._convert_date_obj_by_format_default(i);for(;n<i;){let l=e.fn._convert_date_obj_by_format_default(n);e._tour_dates_choose.push(l),n.setDate(n.getDate()+1)}t=e.fn._convert_date_obj_by_format_default(t);let d=e._tour_dates_choose.indexOf(t);if(null!==e._dates_disable){let u=e._dates_disable.indexOf(t);if(d>-1)return u>-1?t==r?[!1,"date-picked start-date",""]:t==o?[!1,"date-picked end-date",""]:[!1,"date-picked",""]:t==r?[!0,"date-picked start-date","Available"]:t==o?[!0,"date-picked end-date","Available"]:[!0,"date-picked","Available"];return u>-1?[!1,"",""]:[!0,"","Available"]}return d>-1?t==r?[!0,"date-picked start-date",""]:t==o?[!0,"date-picked end-date",""]:[!0,"date-picked",""]:[!0,"",""]}if(t=e.fn._convert_date_obj_by_format_default(t),null!==e._dates_disable){let c=e._dates_disable.indexOf(t);if(c>-1)return[!1,"",""]}return[!0,"","Available"]};m.datepicker("option","beforeShowDay",w),m.datepicker("option","onClose",function(t){e.fn.update_tour_total_price()})}if(r.length>0&&(A=r.find("input[name=tour_date_check_in]"),O=r.find("input[name=tour_date_check_out]"),jQuery().datepicker&&(A.datepicker(k),A.datepicker("option","onClose",function(t){if(e.fn._show_range_dates_choose(),""!==t){let a=new Date(e.fn._convert_date_to_format_default(t));a.setDate(a.getDate()+1),O.datepicker("option","minDate",a),e.fn.update_tour_total_price(),t!==e._tour_date_check_in_old&&(e._tour_date_check_in_old=t)}}),O.datepicker({dateFormat:e._tour_date_format,minDate:l,yearRange:l.getFullYear()+":"+e._max_year}),O.datepicker("option","onClose",function(t){e.fn._show_range_dates_choose(),e.fn.update_tour_total_price()}))),(i=n.find(".tour-datepicker-range-checkin-checkout")).length>0){o=i.find("input[name=tour_datepicker_range_checkin_checkout]");let j={minDate:l,opens:"left",drops:"up",locale:{format:e._date_format_default_datepicker_range}};o.daterangepicker(j,function(e,t){})}p.length>0&&p.on("change keyup",function(t){e.fn.update_tour_total_price()})},e.fn.get_price_tours_default=function(){j.regular_price_dates=parseFloat(d.val()),h&&(j.child_price_dates=parseFloat(s.val())),D&&e.each(D,function(t,a){1==a.set_price&&1==a.enable&&(j[t]||(j[t]={}),e.each(a.variation_attr,function(e,a){j[t][e]=parseFloat(a.price)}))})},e.fn.update_tour_total_price=function(){e.fn.get_price_tours_default();let t=0;e(".field-travel-booking");let a=0,n=parseInt(l.val());a+=n;let r=0;c.length&&(a+=r=parseInt(c.val()));let i=A&&A.length&&O&&O.length&&""!==A.val()&&""!==O.val(),o=e._tour_price_of_dates_option&&e._tour_price_of_dates_option.price_dates_range&&!e.isEmptyObject(e._tour_price_of_dates_option.price_dates_range);if(m.length&&""!==m.val()){let d=new Date(e.fn._convert_date_to_format_default(m.val()));o&&e.each(e._tour_price_of_dates_option.price_dates_range,function(t,a){let n=new Date(a.start_date),r=new Date(a.end_date);d>=n&&d<=r&&e.each(a.prices,function(t,a){if(j[t]){if("regular_price_dates"==t||"child_price_dates"==t){var n=parseFloat(a.price);n>0&&(j[t]=n)}else e.each(a,function(e,a){j[t]&&(n=parseFloat(a.price))>0&&(j[t][e]=n)})}})})}else if(i){let s=new Date(e.fn._convert_date_to_format_default(A.val())),p=new Date(e.fn._convert_date_to_format_default(O.val())),h=s,v={},g=e.fn._calculate_total_night(s,p),$=e(".number-day");for($.text(g);h<p;){if(o){let k=[];e.each(e._tour_price_of_dates_option.price_dates_range,function(t,a){let n=new Date(a.start_date),r=new Date(a.end_date);h>=n&&h<=r&&(k.push(h),e.each(a.prices,function(t,a){if(j[t]){if("regular_price_dates"==t||"child_price_dates"==t){let n=parseFloat(a.price);(isNaN(n)||n<=0)&&(n=j[t]),v[t]?v[t]+=n:v[t]=n}else e.each(a,function(e,a){if(j[t][e]){let n=parseFloat(a.price);(isNaN(n)||n<=0)&&(n=j[t][e]),v[t]||(v[t]={}),v[t][e]?v[t][e]+=n:v[t][e]=n}})}}))}),-1===k.indexOf(h)&&e.fn.getPriceDatesDefaultByDateRange(v,j)}else e.fn.getPriceDatesDefaultByDateRange(v,j);h.setDate(h.getDate()+1)}j.regular_price_dates=v.regular_price_dates,j.child_price_dates=void 0==v.child_price_dates?0:v.child_price_dates,e.each(j,function(t,a){"regular_price_dates"!=t&&"child_price_dates"!=t&&e.each(a,function(e,a){j[t][e]=v[t][e]})})}if(e.each(j,function(a,i){if("regular_price_dates"==a){let o=j[a]*n;t+=o,u.text(e.fn.tour_price_format(j[a]))}else if("child_price_dates"==a){let l=j[a]*r;t+=l,f.text(e.fn.tour_price_format(j[a]))}else e.each(i,function(n,r){var i,o=j[a][n];switch(D[a].type_variation){case"quantity":t+=o*parseInt(e("input[name="+n+"]").val());break;case"checkbox":var l=e("input[name="+n+"]");l.is(":checked")&&(t+=o);break;case"radio":var l=e("input[name="+a+"]:checked");if(l.val()==n){var o=j[a][n];t+=o}break;case"select":var d=e("select[name="+a+"]").val();d==n&&j[a][d]&&(t+=o)}e(".price_"+n).text(e.fn.tour_price_format(o))})}),b){let _=y.find(".val-discount"),x=y.find(".woocommerce-Price-currencySymbol"),Y=y.find(".total-people");try{let F=0,M=0;e.each(b,function(e,t){let n=parseInt(t.number_customer);n<=a&&F<n&&(F=n,M=t.discount)}),0!==F?(_.text(M),Y.text(a),y.show(),/\%$/.test(M)?(x.hide(),M=parseFloat(M),t-=t*M/100):(M=parseFloat(M),_.text(M.toFixed(C)),x.show(),t-=M)):y.hide()}catch(S){console.error(S)}}w.text(e.fn.tour_price_format(t))},e.fn.getPriceDatesDefaultByDateRange=function(t,a){t.regular_price_dates?t.regular_price_dates+=a.regular_price_dates:t.regular_price_dates=a.regular_price_dates,t.child_price_dates?t.child_price_dates+=a.child_price_dates:t.child_price_dates=a.child_price_dates,e.each(a,function(n,r){"regular_price_dates"!=n&&"child_price_dates"!=n&&e.each(r,function(e,r){t[n]||(t[n]={}),t[n][e]?t[n][e]+=a[n][e]:t[n][e]=a[n][e]})})},e.fn.tour_booking_submit=function(){e(".btn-booking").on("click",function(t){var a;t.preventDefault();let n=e(this),i=!1,o=e("input[name=first_name]"),l=e("input[name=last_name]"),d=e("input[name=email_tour]"),u=e("input[name=phone]"),s=e("input[name=number_ticket]"),f=parseInt(s.val()),p=e("input[name=url_home]").val();e("input[name=deposit_radio]");let h=parseInt(s.attr("max")),v=e(".tour-variation-item");if(o.length>0&&0==o.val().length){o.attr("placeholder",travel_booking.message_er_first_name),o.addClass("error");return}if(l.length>0&&0==l.val().length){l.attr("placeholder",travel_booking.message_er_last_name),l.addClass("error");return}if(d.length>0&&(a=d.val(),!/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a))){d.attr("placeholder",travel_booking.message_er_email),d.addClass("error"),d.val("");return}if(u.length>0&&0==u.val().length){u.attr("placeholder",travel_booking.message_er_phone),u.addClass("error");return}if(m.length>0&&0==m.val().length){m.attr("placeholder",travel_booking.message_er_date),m.addClass("error");return}if(isNaN(f)||f<=0)s.val(1);else if(f>h)return;if(!n.hasClass("disable")){let g={nonce:e("input[name=nonce]").val(),tour_id:e("input[name=tour_id]").val(),date_booking:m.val()};if(g.number_ticket=s.val(),c.length>0){let $=c.val();(isNaN($)||0>parseFloat($))&&($=0),g.number_children=$}if(_.length>0&&(g.tour_variations={},e.each(v,function(t){let a=e(this),n=a.data("variation-id"),r=a.data("type_variation"),o=parseInt(a.data("required")),l=a.find(".field-travel-booking"),d=l.length,u=0;if("quantity"!==r||i){if("select"!==r||i){if("checkbox"!==r||i){if("radio"===r&&!i){let c=!0;e.each(l,function(t){let r=e(this);r.is(":checked")&&(void 0===g.tour_variations[n]&&(g.tour_variations[n]={}),u=parseInt(r.val()),g.tour_variations[n][u]={},c=!1,i=!1),o&&c&&t===d-1&&(i=!0,a.addClass("errors"),setTimeout(function(){a.removeClass("errors")},2e3))})}}else{let s=!0;e.each(l,function(t){let r=e(this);r.is(":checked")&&(void 0===g.tour_variations[n]&&(g.tour_variations[n]={}),u=parseInt(r.val()),g.tour_variations[n][u]={},s=!1,i=!1),o&&s&&t===d-1&&(i=!0,a.addClass("errors"),setTimeout(function(){a.removeClass("errors")},2e3))})}}else{let f=a.find(".field-travel-booking");(u=parseInt(f.val()))>0?(void 0===g.tour_variations[n]&&(g.tour_variations[n]={}),g.tour_variations[n][u]={}):o&&(i=!0,f.addClass("errors"),setTimeout(function(){f.removeClass("errors")},2e3))}}else{let p=!0;e.each(l,function(t){let r=e(this);u=parseInt(r.attr("name")),parseFloat(r.val())>0&&(void 0===g.tour_variations[n]&&(g.tour_variations[n]={}),g.tour_variations[n][u]={},g.tour_variations[n][u].quantity=r.val(),p=!1),o&&p&&t===d-1&&(i=!0,a.addClass("errors"),setTimeout(function(){a.removeClass("errors")},2e3))})}}),g.tour_variations=JSON.stringify(g.tour_variations)),r.length>0&&A.length>0&&O.length>0){if(""===A.val()){A.attr("placeholder",travel_booking.message_er_date_checkin),A.addClass("error");return}if(""===O.val()){O.attr("placeholder",travel_booking.message_er_date_checkout),O.addClass("error");return}g.date_check_in=A.val(),g.date_check_out=O.val()}k.length>0&&e.each(k,function(t){e(this).is(":checked")&&(g.webtomizer_tour_deposit=e(this).val())}),i||(e(".spinner").show(),n.addClass("disable"),e.ajax({url:p+"?tb-ajax=add_tour_to_cart_phys",type:"post",data:g,dataType:"json",success(t){if("success"===t.status){let a={first_name:o.val(),last_name:l.val(),email:d.val(),phone:u.val()};document.cookie="info_user="+JSON.stringify(a)+"; path=/",window.location=e("input[name=checkout_url]").val()}else alert(t.message)},error(e){console.error(e)}}).done(function(){e(".spinner").hide(),n.removeClass("disable")}))}})},e.fn.tour_orderby=function(){e(".tour-ordering").find(".orderby").on("change",function(){e(".tour-ordering").submit()})},e.fn.load_ajax_notify=function(){a=!1;let t=e("input[name=notify_limit]").val(),n=e("input[name=url_home]").val();e.ajax({url:n+"?tb-ajax=notify_new_order",type:"post",data:"limit="+t,dataType:"json",success(t){"success"==t.status&&(e(".list-order-tour").html(t.html),a=!0)}})},e.fn.load_notify_products_of_order=function(){let t=e("input[name=notify_available]");if(t.length){a=!0;let n=e("input[name=notify_refresh]").val();""==n&&(n=1e4),setInterval(function(){a&&e.fn.load_ajax_notify()},n)}},e.fn._convert_date_to_format_default=function(a){let n="",r="",i="",o="";if("yy/mm/dd"===e._tour_date_format){let l=a.split("/");r=l[2],i=l[1],o=l[0]}else if("yy-mm-dd"===e._tour_date_format){let d=a.split("-");r=d[2],i=d[1],o=d[0]}else if("dd/mm/yy"===e._tour_date_format){let u=a.split("/");r=u[0],i=u[1],o=u[2]}else if("dd-mm-yy"===e._tour_date_format){let c=a.split("-");r=c[0],i=c[1],o=c[2]}else if("mm/dd/yy"===e._tour_date_format){let s=a.split("/");r=s[1],i=s[0],o=s[2]}else if("mm-dd-yy"===e._tour_date_format){let f=a.split("-");r=f[1],i=f[0],o=f[2]}else if("DD, d MM, yy"===e._tour_date_format){let p=a.split(","),m=p[1].trim().split(" ");r=m[0],10>parseInt(i=t.indexOf(m[1])+1)&&(i="0"+i),o=p[2]}return n+(o+"/"+i+"/"+r)},e.fn._convert_date_obj_by_format_default=function(e){let t="",a=e.getFullYear(),n=("0"+(e.getMonth()+1)).slice(-2),r=("0"+e.getDate()).slice(-2);return t+(a+"/"+n+"/"+r)},e.fn._calculate_total_days=function(e,t){let a=new Date(e),n=new Date(t),r=a,i=0;for(;r<=n;)r.setDate(r.getDate()+1),i+=1;return i},e.fn._calculate_total_night=function(e,t){let a=new Date(e.getTime()),n=0;for(;a<t;)a.setDate(a.getDate()+1),n+=1;return n},e.fn._show_range_dates_choose=function(){let t=A.val(),a=O.val();if(""!=t&&""!=a){e._tour_dates_choose=[];let n=new Date(e.fn._convert_date_to_format_default(A.val())),r=new Date(e.fn._convert_date_to_format_default(O.val())),i=n;for(r.setDate(r.getDate()+1);i<r;){let o=e.fn._convert_date_obj_by_format_default(i);e._tour_dates_choose.push(o),i.setDate(i.getDate()+1)}let l=function(t){t=e.fn._convert_date_obj_by_format_default(t);let a=e._tour_dates_choose.indexOf(t);if(null!==e._dates_disable){let i=e._dates_disable.indexOf(t);if(a>-1)return i>-1?t==n?[!1,"date-picked start-date",""]:t==r?[!1,"date-picked end-date",""]:[!1,"date-picked",""]:t==n?[!0,"date-picked start-date","Available"]:t==r?[!0,"date-picked end-date","Available"]:[!0,"date-picked","Available"];return i>-1?[!1,"",""]:[!0,"","Available"]}return a>-1?t==n?[!0,"date-picked start-date",""]:t==r?[!0,"date-picked end-date",""]:[!0,"date-picked",""]:[!0,"",""]},d=function(t){t=e.fn._convert_date_obj_by_format_default(t);let a=e._tour_dates_choose.indexOf(t);return a>-1?t==n?[!0,"date-picked start-date",""]:t==r?[!0,"date-picked end-date",""]:[!0,"date-picked",""]:[!0,"",""]};jQuery().datepicker&&(A.datepicker("option","beforeShowDay",l),O.datepicker("option","beforeShowDay",d))}},e.fn.filter_tour_price_widget=function(){let t=document.getElementById("tour-price-range");if(t){let a=e(".tour-min-price"),n=e(".tour-max-price"),r=parseFloat(e("input[name=tour_start_price_fitler]").val()),i=parseFloat(e("input[name=tour_end_price_filter]").val()),o=e("input[name=tour_max_price]"),l=e("input[name=tour_min_price]"),d=parseFloat(l.val()),u=parseFloat(o.val());d<u&&(noUiSlider.create(t,{start:[d,u],connect:!0,range:{min:r,max:i}}),t.noUiSlider.on("update",function(e){let t=e[0],r=e[1];l.val(t),o.val(r),a.text(t),n.text(r)}))}},e.fn.tour_price_format=function(e){return e=e.toFixed(C)}}(jQuery,"tour-booking-phys"),jQuery(function(e){"use strict";e.fn.tour_booking_init(),e.fn.tour_booking_submit(),e.fn.load_notify_products_of_order(),e.fn.filter_tour_price_widget(),e("#tour_rating").length&&e("#tour_rating").barrating({theme:"css-stars"})});
