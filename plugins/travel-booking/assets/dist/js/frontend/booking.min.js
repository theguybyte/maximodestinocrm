!function(e){"use strict";let t,a,n,o,r,i,_=[],l=!1,d=null,s=null,c=null,u=null,f=null,p=null,m=null,v=null,h=null,g=null,b=null,y=null,k=!1,D=null,x=null,w=null,j=null;const C={};let F=0;e.fn.tour_booking_init=function(){d=e("form#tourBookingForm"),N("info_user")&&(r=JSON.parse(N("info_user"))),d.length>0&&(e.fn._get_elms_tour_booking_form(),e.fn.tour_booking(),r&&(e("input[name=first_name]").val(r.first_name),e("input[name=last_name]").val(r.last_name),e("input[name=email_tour]").val(r.email),e("input[name=phone]").val(r.phone))),r&&(e("input[name=billing_first_name]").val(r.first_name),e("input[name=billing_last_name]").val(r.last_name),e("input[name=billing_email]").val(r.email),e("input[name=billing_phone]").val(r.phone))},e.fn._get_elms_tour_booking_form=function(){p=d.find("input[name=price_ticket]"),f=d.find("input[name=number_ticket]"),m=d.find(".price_ticket"),v=d.find("input[name=number_children]"),h=d.find("input[name=price_children]"),b=d.find(".field-travel-booking"),g=d.find(".price_child"),s=d.find(".tour_date_checkin_checkout"),y=d.find("input[name=date_book]"),D=d.find("input[name=tour_date_starts_after]"),x=d.find("input[name=tour_duration_number]"),t=d.find("input[name=tour_group_discount_data_phys]"),w=d.find(".label-tour-group-discount"),j=d.find("input[name=webtomizer_tour_deposit]"),n=d.find("input[name=_tour_variations_options]");const a=d.find("input[name=tour_month]");i=d.find(".tour-subtotal"),F=e("input[name=woocommerce_price_num_decimals]").val(),v.length>0&&(k=!0),a.length&&(_=a.val().split(","))},e._dates_disable=null,e._max_year=null,e._date_format_default="yy/mm/dd",e._date_format_default_datepicker_range="YYYY/MM/DD",e._tour_date_format=null,e._date_format_convert_php_js={"Y/m/d":"yy/mm/dd","Y-m-d":"yy-mm-dd","d/m/Y":"dd/mm/yy","d-m-Y":"dd-mm-yy","m/d/Y":"mm/dd/yy","m-d-Y":"mm-dd-yy","D, d M, Y":"D, d M, yy","l, d F, Y":"DD, d MM, yy"},e._tour_date_check_in_old="";let O=null,I=null,S=null;function N(e){const t=e+"=",a=decodeURIComponent(document.cookie).split(";");for(let e=0;e<a.length;e++){let n=a[e];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}e._tour_price_of_dates_option=null,e.fn.tour_booking=function(){let r=0;const i=new Date,_=new Date,l=d.find("input[name=phys_tour_dates_disable]"),f=d.find("input[name=phys_tour_max_year_enable]");O=d.find("input[name=phys_tour_price_dates_type]").val();const p=d.find("input[name=phys_tour_price_of_dates_option]");if(n.length>0)try{o=JSON.parse(n.val())}catch(e){o=null}if(t.length)try{a=JSON.parse(t.val())}catch(e){a=null}if(e.fn.update_tour_total_price(),p.length>0&&""!==p.val()&&"{}"!==p.val())try{e._tour_price_of_dates_option=JSON.parse(p.val())}catch(t){e._tour_price_of_dates_option=null}if(e._tour_date_format=e._date_format_default,void 0!==e._date_format_convert_php_js[travel_booking.tour_date_format]&&(e._tour_date_format=e._date_format_convert_php_js[travel_booking.tour_date_format]),e._max_year=f.val(),l.length>0&&""!==l.val()&&(e._dates_disable=JSON.parse(l.val())),D.length>0&&""!=D.val()&&0!==parseInt(D.val())&&(r=parseInt(D.val())),null!==e._dates_disable){let t=e.fn._convert_date_obj_by_format_default(_);for(;e._dates_disable.indexOf(t)>-1;)_.setDate(_.getDate()+1),t=e.fn._convert_date_obj_by_format_default(_);_.setDate(_.getDate()+r)}else _.setDate(i.getDate()+r);const m={dateFormat:e._tour_date_format,minDate:_,yearRange:_.getFullYear()+":"+e._max_year};if(null!==e._dates_disable&&(m.beforeShowDay=function(t){return t=e.fn._convert_date_obj_by_format_default(t),e._dates_disable.indexOf(t)>-1?[!1,"",""]:[!0,"","Available"]}),y.length>0&&(delete y.beforeShowDay,jQuery().datepicker)){y.datepicker(m),y.datepicker("setDate",_);const t=parseInt(x.val()),a=function(a){if(e._tour_dates_choose=[],""!==y.val()){const n=new Date(e.fn._convert_date_to_format_default(y.val())),o=n,r=e.fn._convert_date_obj_by_format_default(n),i=new Date(e.fn._convert_date_to_format_default(y.val()));i.setDate(n.getDate()+t);const _=e.fn._convert_date_obj_by_format_default(i);for(;o<i;){const t=e.fn._convert_date_obj_by_format_default(o);e._tour_dates_choose.push(t),o.setDate(o.getDate()+1)}a=e.fn._convert_date_obj_by_format_default(a);const l=e._tour_dates_choose.indexOf(a);if(null!==e._dates_disable){const t=e._dates_disable.indexOf(a);return l>-1?t>-1?a==r?[!1,"date-picked start-date",""]:a==_?[!1,"date-picked end-date",""]:[!1,"date-picked",""]:a==r?[!0,"date-picked start-date","Available"]:a==_?[!0,"date-picked end-date","Available"]:[!0,"date-picked","Available"]:t>-1?[!1,"",""]:[!0,"","Available"]}return l>-1?a==r?[!0,"date-picked start-date",""]:a==_?[!0,"date-picked end-date",""]:[!0,"date-picked",""]:[!0,"",""]}return a=e.fn._convert_date_obj_by_format_default(a),null!==e._dates_disable&&e._dates_disable.indexOf(a)>-1?[!1,"",""]:[!0,"","Available"]};y.datepicker("option","beforeShowDay",a),y.datepicker("option","onClose",(function(t){e.fn.update_tour_total_price()}))}if(s.length>0&&(I=s.find("input[name=tour_date_check_in]"),S=s.find("input[name=tour_date_check_out]"),jQuery().datepicker&&(I.datepicker(m),I.datepicker("option","onClose",(function(t){if(e.fn._show_range_dates_choose(),""!==t){const a=new Date(e.fn._convert_date_to_format_default(t));a.setDate(a.getDate()+1),S.datepicker("option","minDate",a),e.fn.update_tour_total_price(),t!==e._tour_date_check_in_old&&(e._tour_date_check_in_old=t)}})),S.datepicker({dateFormat:e._tour_date_format,minDate:_,yearRange:_.getFullYear()+":"+e._max_year}),S.datepicker("option","onClose",(function(t){e.fn._show_range_dates_choose(),e.fn.update_tour_total_price()})))),c=d.find(".tour-datepicker-range-checkin-checkout"),c.length>0){u=c.find("input[name=tour_datepicker_range_checkin_checkout]");const t={minDate:_,opens:"left",drops:"up",locale:{format:e._date_format_default_datepicker_range}};u.daterangepicker(t,(function(e,t){}))}b.length>0&&b.on("change keyup",(function(t){e.fn.update_tour_total_price()}))},e.fn.get_price_tours_default=function(){C.regular_price_dates=parseFloat(p.val()),k&&(C.child_price_dates=parseFloat(h.val())),o&&e.each(o,(function(t,a){1==a.set_price&&1==a.enable&&(C[t]||(C[t]={}),e.each(a.variation_attr,(function(e,a){C[t][e]=parseFloat(a.price)})))}))},e.fn.update_tour_total_price=function(){e.fn.get_price_tours_default();let t=0;e(".field-travel-booking");let n=0;const r=parseInt(f.val());n+=r;let _=0;v.length&&(_=parseInt(v.val()),n+=_);const l=I&&I.length&&S&&S.length&&""!==I.val()&&""!==S.val(),d=e._tour_price_of_dates_option&&e._tour_price_of_dates_option.price_dates_range&&!e.isEmptyObject(e._tour_price_of_dates_option.price_dates_range);let s,c;if(y.length&&""!==y.val()){const t=parseFloat(x.val());s=new Date(e.fn._convert_date_to_format_default(y.val())),c=structuredClone(s),t>1?c.setDate(c.getDate()+t):1===t&&c.setDate(c.getDate()+1)}else l&&(s=new Date(e.fn._convert_date_to_format_default(I.val())),c=new Date(e.fn._convert_date_to_format_default(S.val())));if(!s||!c)return;let u=structuredClone(s);const p={},h=e.fn._calculate_total_night(s,c);for(e(".number-day").text(h);u<c;){if(d){const t=[];e.each(e._tour_price_of_dates_option.price_dates_range,(function(a,n){const o=new Date(n.start_date),r=new Date(n.end_date);u>=o&&u<=r&&(t.push(u),e.each(n.prices,(function(t,a){if(C[t])if("regular_price_dates"===t||"child_price_dates"===t){let e=parseFloat(a.price);(isNaN(e)||e<=0)&&(e=C[t]),p[t]?p[t]+=e:p[t]=e}else e.each(a,(function(e,a){if(C[t][e]){let n=parseFloat(a.price);(isNaN(n)||n<=0)&&(n=C[t][e]),p[t]||(p[t]={}),p[t][e]?p[t][e]+=n:p[t][e]=n}}))})))})),-1===t.indexOf(u)&&e.fn.getPriceDatesDefaultByDateRange(p,C)}else e.fn.getPriceDatesDefaultByDateRange(p,C);u.setDate(u.getDate()+1)}if(C.regular_price_dates=p.regular_price_dates,C.child_price_dates=null==p.child_price_dates?0:p.child_price_dates,e.each(C,(function(t,a){"regular_price_dates"!==t&&"child_price_dates"!==t&&e.each(a,(function(e,a){p[t]&&p[t][e]&&(C[t][e]=p[t][e])}))})),e.each(C,(function(a,n){if("regular_price_dates"==a){const n=C[a]*r;t+=n,m.text(e.fn.tour_price_format(C[a]))}else if("child_price_dates"==a){const n=C[a]*_;t+=n,g.text(e.fn.tour_price_format(C[a]))}else e.each(n,(function(n,r){var i=C[a][n];switch(o[a].type_variation){case"quantity":var _=parseInt(e("input[name="+n+"]").val());t+=i*_;break;case"checkbox":e("input[name="+n+"]").is(":checked")&&(t+=i);break;case"radio":e("input[name="+a+"]:checked").val()==n&&(i=C[a][n],t+=i);break;case"select":var l=e("select[name="+a+"]").val();l==n&&C[a][l]&&(t+=i)}e(".price_"+n).text(e.fn.tour_price_format(i))}))})),a){const o=w.find(".val-discount"),r=w.find(".woocommerce-Price-currencySymbol"),i=w.find(".total-people");try{let _=0,l=0;if(e.each(a,(function(e,t){const a=parseInt(t.number_customer);a<=n&&_<a&&(_=a,l=t.discount)})),0!==_){const e=/\%$/;o.text(l),i.text(n),w.show(),e.test(l)?(r.hide(),l=parseFloat(l),t-=t*l/100):(l=parseFloat(l),o.text(l.toFixed(F)),r.show(),t-=l)}else w.hide()}catch(e){console.error(e)}}i.text(e.fn.tour_price_format(t))},e.fn.getPriceDatesDefaultByDateRange=function(t,a){t.regular_price_dates?t.regular_price_dates+=a.regular_price_dates:t.regular_price_dates=a.regular_price_dates,t.child_price_dates?t.child_price_dates+=a.child_price_dates:t.child_price_dates=a.child_price_dates,e.each(a,(function(n,o){"regular_price_dates"!=n&&"child_price_dates"!=n&&e.each(o,(function(e,o){t[n]||(t[n]={}),t[n][e]?t[n][e]+=a[n][e]:t[n][e]=a[n][e]}))}))},e.fn.tour_booking_submit=function(){e(".btn-booking").on("click",(function(t){t.preventDefault();const a=e(this);let o=!1;const r=e("input[name=first_name]"),i=e("input[name=last_name]"),_=e("input[name=email_tour]"),l=e("input[name=phone]"),c=e("input[name=number_ticket]"),u=parseInt(c.val()),f=e("input[name=url_home]").val(),p=(e("input[name=deposit_radio]"),parseInt(c.attr("max"))),m=e(".tour-variation-item");if(r.length>0&&0==r.val().length)return r.attr("placeholder",travel_booking.message_er_first_name),void r.addClass("error");if(i.length>0&&0==i.val().length)return i.attr("placeholder",travel_booking.message_er_last_name),void i.addClass("error");if(_.length>0&&(h=_.val(),!/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(h)))return _.attr("placeholder",travel_booking.message_er_email),_.addClass("error"),void _.val("");var h;if(l.length>0&&0==l.val().length)return l.attr("placeholder",travel_booking.message_er_phone),void l.addClass("error");if(y.length>0&&0==y.val().length)return y.attr("placeholder",travel_booking.message_er_date),void y.addClass("error");if(isNaN(u)||u<=0)c.val(1);else if(u>p)return;if(!a.hasClass("disable")){const t={nonce:e("input[name=nonce]").val(),tour_id:e("input[name=tour_id]").val(),date_booking:y.val()};if(t.number_ticket=c.val(),v.length>0){let e=v.val();(isNaN(e)||parseFloat(e)<0)&&(e=0),t.number_children=e}if(n.length>0&&(t.tour_variations={},e.each(m,(function(a){const n=e(this),r=n.data("variation-id"),i=n.data("type_variation"),_=parseInt(n.data("required")),l=n.find(".field-travel-booking"),d=l.length;let s=0;if("quantity"!==i||o)if("select"!==i||o)if("checkbox"!==i||o){if("radio"===i&&!o){let a=!0;e.each(l,(function(i){const l=e(this);l.is(":checked")&&(void 0===t.tour_variations[r]&&(t.tour_variations[r]={}),s=parseInt(l.val()),t.tour_variations[r][s]={},a=!1,o=!1),_&&a&&i===d-1&&(o=!0,n.addClass("errors"),setTimeout((function(){n.removeClass("errors")}),2e3))}))}}else{let a=!0;e.each(l,(function(i){const l=e(this);l.is(":checked")&&(void 0===t.tour_variations[r]&&(t.tour_variations[r]={}),s=parseInt(l.val()),t.tour_variations[r][s]={},a=!1,o=!1),_&&a&&i===d-1&&(o=!0,n.addClass("errors"),setTimeout((function(){n.removeClass("errors")}),2e3))}))}else{const e=n.find(".field-travel-booking");s=parseInt(e.val()),s>0?(void 0===t.tour_variations[r]&&(t.tour_variations[r]={}),t.tour_variations[r][s]={}):_&&(o=!0,e.addClass("errors"),setTimeout((function(){e.removeClass("errors")}),2e3))}else{let a=!0;e.each(l,(function(i){const l=e(this);s=parseInt(l.attr("name")),parseFloat(l.val())>0&&(void 0===t.tour_variations[r]&&(t.tour_variations[r]={}),t.tour_variations[r][s]={},t.tour_variations[r][s].quantity=l.val(),a=!1),_&&a&&i===d-1&&(o=!0,n.addClass("errors"),setTimeout((function(){n.removeClass("errors")}),2e3))}))}})),t.tour_variations=JSON.stringify(t.tour_variations)),s.length>0&&I.length>0&&S.length>0){if(""===I.val())return I.attr("placeholder",travel_booking.message_er_date_checkin),void I.addClass("error");if(""===S.val())return S.attr("placeholder",travel_booking.message_er_date_checkout),void S.addClass("error");t.date_check_in=I.val(),t.date_check_out=S.val()}j.length>0&&e.each(j,(function(a){e(this).is(":checked")&&(t.webtomizer_tour_deposit=e(this).val())})),d.find(".form-field.custom-field *").each((function(){t[e(this).attr("name")]=e(this).val()})),o||(e(".spinner").show(),a.addClass("disable"),e.ajax({url:f+"?tb-ajax=add_tour_to_cart_phys",type:"post",data:t,dataType:"json",success(t){if("success"===t.status){const t={first_name:r.val(),last_name:i.val(),email:_.val(),phone:l.val()};document.cookie="info_user="+JSON.stringify(t)+"; path=/",window.location=e("input[name=checkout_url]").val()}else alert(t.message)},error(e){console.error(e)}}).done((function(){e(".spinner").hide(),a.removeClass("disable")})))}}))},e.fn.tour_orderby=function(){e(".tour-ordering").find(".orderby").on("change",(function(){e(".tour-ordering").submit()}))},e.fn.load_ajax_notify=function(){l=!1;const t=e("input[name=notify_limit]").val(),a=e("input[name=url_home]").val();e.ajax({url:a+"?tb-ajax=notify_new_order",type:"post",data:"limit="+t,dataType:"json",success(t){"success"==t.status&&(e(".list-order-tour").html(t.html),l=!0)}})},e.fn.load_notify_products_of_order=function(){if(e("input[name=notify_available]").length){l=!0;let t=e("input[name=notify_refresh]").val();""==t&&(t=1e4),setInterval((function(){l&&e.fn.load_ajax_notify()}),t)}},e.fn._convert_date_to_format_default=function(t){let a="",n="",o="",r="";if("yy/mm/dd"===e._tour_date_format){const e=t.split("/");n=e[2],o=e[1],r=e[0]}else if("yy-mm-dd"===e._tour_date_format){const e=t.split("-");n=e[2],o=e[1],r=e[0]}else if("dd/mm/yy"===e._tour_date_format){const e=t.split("/");n=e[0],o=e[1],r=e[2]}else if("dd-mm-yy"===e._tour_date_format){const e=t.split("-");n=e[0],o=e[1],r=e[2]}else if("mm/dd/yy"===e._tour_date_format){const e=t.split("/");n=e[1],o=e[0],r=e[2]}else if("mm-dd-yy"===e._tour_date_format){const e=t.split("-");n=e[1],o=e[0],r=e[2]}else if("DD, d MM, yy"===e._tour_date_format){const e=t.split(","),a=e[1].trim().split(" ");n=a[0],o=_.indexOf(a[1])+1,parseInt(o)<10&&(o="0"+o),r=e[2]}return a+=r+"/"+o+"/"+n,a},e.fn._convert_date_obj_by_format_default=function(e){let t="";return t+=e.getFullYear()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+("0"+e.getDate()).slice(-2),t},e.fn._calculate_total_days=function(e,t){const a=new Date(e),n=new Date(t),o=a;let r=0;for(;o<=n;)o.setDate(o.getDate()+1),r+=1;return r},e.fn._calculate_total_night=function(e,t){const a=new Date(e.getTime());let n=0;for(;a<t;)a.setDate(a.getDate()+1),n+=1;return n},e.fn._show_range_dates_choose=function(){const t=I.val(),a=S.val();if(""!=t&&""!=a){e._tour_dates_choose=[];const t=new Date(e.fn._convert_date_to_format_default(I.val())),a=new Date(e.fn._convert_date_to_format_default(S.val())),n=t;for(a.setDate(a.getDate()+1);n<a;){const t=e.fn._convert_date_obj_by_format_default(n);e._tour_dates_choose.push(t),n.setDate(n.getDate()+1)}const o=function(n){n=e.fn._convert_date_obj_by_format_default(n);const o=e._tour_dates_choose.indexOf(n);if(null!==e._dates_disable){const r=e._dates_disable.indexOf(n);return o>-1?r>-1?n==t?[!1,"date-picked start-date",""]:n==a?[!1,"date-picked end-date",""]:[!1,"date-picked",""]:n==t?[!0,"date-picked start-date","Available"]:n==a?[!0,"date-picked end-date","Available"]:[!0,"date-picked","Available"]:r>-1?[!1,"",""]:[!0,"","Available"]}return o>-1?n==t?[!0,"date-picked start-date",""]:n==a?[!0,"date-picked end-date",""]:[!0,"date-picked",""]:[!0,"",""]},r=function(n){return n=e.fn._convert_date_obj_by_format_default(n),e._tour_dates_choose.indexOf(n)>-1?n==t?[!0,"date-picked start-date",""]:n==a?[!0,"date-picked end-date",""]:[!0,"date-picked",""]:[!0,"",""]};jQuery().datepicker&&(I.datepicker("option","beforeShowDay",o),S.datepicker("option","beforeShowDay",r))}},e.fn.filter_tour_price_widget=function(){const t=document.getElementById("tour-price-range");if(t){const a=e(".tour-min-price"),n=e(".tour-max-price"),o=parseFloat(e("input[name=tour_start_price_fitler]").val()),r=parseFloat(e("input[name=tour_end_price_filter]").val()),i=e("input[name=tour_max_price]"),_=e("input[name=tour_min_price]"),l=parseFloat(_.val()),d=parseFloat(i.val());l<d&&(t.noUiSlider||window.noUiSlider.create(t,{start:[l,d],connect:!0,range:{min:o,max:r}}),t.noUiSlider.on("update",(function(e){const t=e[0],o=e[1];_.val(t),i.val(o),a.text(t),n.text(o)})))}},e.fn.tour_price_format=function(e){const t=(e=e.toFixed(F)).split(".");return travel_booking.thousand_separator&&(t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,travel_booking.thousand_separator)),t.join(travel_booking.decimal_separator||".")}}(jQuery),jQuery((function(e){"use strict";e.fn.tour_booking_init(),e.fn.tour_booking_submit(),e.fn.load_notify_products_of_order(),e.fn.filter_tour_price_widget(),e(document).ready((function(){e.fn.update_tour_total_price()})),e("#tour_rating").length&&e("#tour_rating").barrating({theme:"css-stars"})}));